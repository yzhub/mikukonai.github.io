#!title:    频谱倾斜与音视频编码
#!date:     2019-12-12
#!authors:  Mikukonai
#!cover:    
#!type:     原创
#!tags:     

#!content

昨天，负责ASR的同事对高频预加重这个步骤的意义产生了疑问。思考了一下，这个问题背后的原因其实还是蛮深刻的，甚至影响了几乎所有常见的有损音视频编码算法的设计。

为了逻辑上的清晰起见，以下叙述将给出标号，并采用自底向上的方式推出结论。

**1.1** 噪声无处不在。除了实际的物理信道的带来的热噪声之外，量化等信号处理过程也会引入噪声。噪声与有用信号之比，称为信噪比（SNR）。

**1.2** 根据香农定理，SNR越高，信道的利用效率越高。

**1.3** 噪声是一个相对概念，是相对于“有意义”的信号而言。常见的热噪声可视为白噪声。所谓白噪声是指功率谱密度在全频段上为常数的噪声。

**2.1** 常见的乐器，如钢琴琴弦，其振动含有基波和多个谐波，谐波的能量随着频率的增大而减小。这是由琴弦的力学性质内禀地决定的。

**2.2** 音乐、人声、以及自然界中的其他一些“有意义”的声音，可以视为遵循2.1谐波分布规律的简单声音成分的线性叠加（弦、膜、空气柱等类似的结构），因此一般上也遵循低频能量较大，高频能量较小的规律。体现在频谱上，就是左高右低的分布。有人称之为**频谱的倾斜现象**。

![钢琴的声谱图](./image/assets/M/piano-spectrum.jpg)

**3** 由1.3和2.2，音频信号在传输或处理的过程中，由于高频成分的能量较小，所以高频侧的SNR往往低于低频侧。

**4.1** 考虑音频信号的传输场景：由1.2香农定理，信号信噪比越高，在有限的带宽下能传输的信息量就越多。因此，基于3的结论，为了提高高频成分的SNR，可以在信源处给信号加一个高通滤波器，提升其高频成分的能量，这称为“预加重”；信宿收到信号后，再做一次去加重操作，即可得到原信号。

**4.2** 考虑音频编码场景：以MPEG/Audio（特别是MP3）为例，时域PCM信号经MDCT变换为频谱，为了对频谱作熵编码（Huffman编码）压缩，MP3充分利用了2.2所述的倾斜特性，将频谱分为低频侧的大值区、中间的小值区和高频侧的零值区三部分（如下图[1]），并分别采用不同的Huffman表进行编码，以提高编码效率。此外，在量化阶段，MP3编码器通过循环的方式，确定每个子频带的放大系数，以保证每个频带引入量化噪声后的信噪比都高于人耳不能察觉的一个阈值。为了减少高频段的循环次数以提升效率，编码器也会预加重频谱的高频部分，以使编码器尽快寻找到合适的放大系数。播放时，解码器会执行去加重，以恢复原来的信号。

![MPEG/Audio 一个编码单元的频谱的分布](./image/assets/M/mp3-spectrum-distribution.jpg)

**5** 不仅音频信号有2.2所述的频谱倾斜特性，图像信号的频谱也有类似的特性。这是比较容易理解的，因为图像的低频成分代表平坦的部分，如天空、白墙，在许多实际的图像中，尤其是动画中，大块的缓变色块占据图像的大部分区域，因此频域上呈现为低频（左上角）能量大、高频（右下角）能量小的特性。如下图[2]所示。

![左边是空域图像，右边是经过DCT的频谱](./image/assets/M/h264-time-freq-transform.jpg)

**6** 基于5所述的特性，主流的有损图像和视频编码（如JPEG、H.264等），会将二维的频谱以Zig-zag的顺序（如下图[3]）排列起来，这样就可以保证在一个序列里，左边的值大，右边的值小（甚至是0），再经过量化，通过熵编码、游程编码等方法去除掉高频侧的连续的0，就可以得到很高的压缩效率。

![Zig-zag 排列方式](./image/assets/M/zig-zag.png)

**7** 综上，音视频信号的这种倾斜的频谱分布特性，可以认为是目前绝大多数压缩算法的最根本依据。至于为什么“有意义”的信号多呈现这种特性，我认为这跟人类感官的响应特性有关，例如带通特性，例如非线性的响应特性（如下图[4]的等响度曲线），等等。

![人耳等响度曲线](./image/assets/M/equal-loudness-curves.png)

# 参考资料

+ [MPEG-1 LayerIII 音訊編碼器於低位元率之改良](https://hdl.handle.net/11296/c7b845)
+ [H.264 Compression Technology](https://www.youtube.com/watch?v=PmoEsPWEdOA)
+ ITU T.81
+ [The Human Auditory System](http://www.mp3-tech.org/programmer/docs/human_auditory_system.pdf)